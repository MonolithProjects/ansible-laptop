---
- name: Bootstrap laptop
  hosts: laptop
  become: yes
  gather_facts: yes
  handlers:
  - import_tasks: ../handlers/main.yml
  tasks:
  - name: Connection test
    ping:

######### DNF Repositories ############

  - name: Set Microsoft Repo
    yum_repository:
      name: code
      description: vscode
      file: vscode
      gpgkey: https://packages.microsoft.com/keys/microsoft.asc
      baseurl: https://packages.microsoft.com/yumrepos/vscode

  - name: Set Slack Repo
    yum_repository:
      name: slack
      description: Slack
      file: slack
      gpgkey: https://slack.com/gpg/slack_pubkey_2019.gpg
      baseurl: "https://packagecloud.io/slacktechnologies/slack/{{ ansible_distribution | lower }}/21/{{ ansible_machine }}"
      # No slack repo for fedora 32 :-(
      #  baseurl: "https://packagecloud.io/slacktechnologies/slack/{{ ansible_distribution | lower }}/{{ ansible_distribution_major_version }}/{{ ansible_machine }}"

  - name: Set Docker package Repo
    yum_repository:
      name: docker
      description: Docker dnf Repo
      file: docker
      gpgkey: https://download.docker.com/linux/fedora/gpg
      baseurl: https://download.docker.com/linux/fedora/31/$basearch/stable

  # - name: Set VirtualBox Repo
  #   yum_repository:
  #     name: virtualbox
  #     description: Fedora $releasever - $basearch - VirtualBox
  #     file: virtualbox
  #     gpgkey: https://www.virtualbox.org/download/oracle_vbox.asc
  #     baseurl: http://download.virtualbox.org/virtualbox/rpm/fedora/$releasever/$basearch

  - name: Set Brave Repo
    yum_repository:
      name: brave-browser
      description: Brave browser
      file: brave-browser
      baseurl: https://brave-browser-rpm-release.s3.brave.com/x86_64/

  - name: Set Yarn Repo
    yum_repository:
      name: yarn
      description: Yarn Repo
      file: yarn
      gpgkey: https://dl.yarnpkg.com/rpm/pubkey.gpg
      baseurl: https://dl.yarnpkg.com/rpm/

  - name: Enabled Gitflow repo
    yum_repository:
      name: elegos/gitflow
      description: Gitflow repo
      file: copr:copr.fedorainfracloud.org:elegos:gitflow.repo
      gpgkey: https://download.copr.fedorainfracloud.org/results/elegos/gitflow/pubkey.gpg
      baseurl: https://download.copr.fedorainfracloud.org/results/elegos/gitflow/fedora-$releasever-$basearch/

  - name: Install EPEL Repo
    import_role:
      name: robertdebock.epel

  - name: Install RPM Fusion Free
    dnf:
      name: "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_major_version }}.noarch.rpm"
      state: present

  - name: Install RPM Fusion Non-Free
    dnf:
      name: "https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_major_version }}.noarch.rpm"
      state: present

######### Snap ########################

  - name: Install snapd
    package:
      name: snapd
      state: present
    notify: start snapd

  - name: Flush handlers
    meta: flush_handlers

  - name: Create /snap for Snap calssic
    file:
      src: /var/lib/snapd/snap
      dest: /snap
      state: link