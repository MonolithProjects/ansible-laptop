---
- name: Additions
  hosts: laptop
  become: no
  gather_facts: yes
  tasks:

######### Fish shell addons and customization ############

  - name: Get fisher - create temp file
    tempfile:
      state: file
      suffix: fisher
    register: tempfile
    when: '"fish" in dnf_packages'

  - name: Get fisher - download script
    get_url:
      url: https://git.io/fisher
      dest: "{{ tempfile.path }}"
      mode: '0755'
    when: '"fish" in dnf_packages'

  - name: Get fisher - run script
    shell: source "{{ tempfile.path }}" && fisher install jorgebucaran/fisher
    args:
      executable: /usr/bin/fish
    changed_when: false
    when: '"fish" in dnf_packages'

  - name: Add fish-kubectl-completions
    shell: fisher install evanlucas/fish-kubectl-completions
    args:
      executable: /usr/bin/fish
    changed_when: false
    when: 
      - '"fish" in dnf_packages'
      - '"kubectl" in snap_packages_classic'

  - name: Install/update addons
    shell: fisher install "{{ item }}"
    args:
      executable: /usr/bin/fish
    changed_when: false
    with_items: "{{ fisher_addons }}"
    when: '"fish" in dnf_packages'

  - name: Copy Welcome screen
    copy:
      src: files/fish_greeting.fish
      dest: "/home/{{ ansible_user }}/.config/fish/functions/fish_greeting.fish"
      mode: 0600
